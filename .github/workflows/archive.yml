name: archive
on:
  schedule:
    - cron: 0 0 * * *
  workflow_dispatch:
jobs:
  archive:
    name: Archive AC submissions
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout the Git repository
        uses: actions/checkout@v3
      - name: Setup Go
        uses: actions/setup-go@v3.2.1
        with:
          go-version: 1.19
      - name: Cache the Go local modules
        uses: actions/cache@v3
        with:
          path: ~/go/pkg/mod
          key: go
          restore-keys: go
      - name: Install procon-gardener
        run: go install github.com/togatoga/procon-gardener@7128766
      - name: Setup procon-gardener
        run: ln -s $GITHUB_WORKSPACE/.procon-gardener ~/.procon-gardener
      - name: Archive AC submissions
        run: ~/go/bin/procon-gardener archive
      - name: Update the Git remote repository
        run: git push
